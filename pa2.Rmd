---
title: "Impacts of Severe Weather Events in the United States"
author: "Student"
date: "August 23, 2015"
output:
  html_document:
    fig_caption: yes
    toc: true
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(
  cache = FALSE
)
```
<style>
  blockquote {
    color: #666;
  }
  h4 {
    font-size: 20px !important;
  }
  td, th {
    padding: 0.5em !important;
  }
  p.caption {
    width: 80%; 
    margin-left: 20%; margin-bottom: 2em;
    padding-top: 0.5em;
    text-align: right;
    font-size: 120%;
    font-weight: bold;
    color: #666;
    border-top: 1px solid #ccc;
  }
  #TOC {
    width: 80%;
    background: #f6f6f6;
    padding: 2em 0 2em 0;
  }
  .footer_spacer {
    margin-top: 6em
  }
</style>

## Synopsis

In this report we explore the most impactful severe weather events recorded in the United States in the [NOAA Storm Events Database](https://www.ncdc.noaa.gov/stormevents/ftp.jsp). We use cumulative measures of personal harm (fatalities, injuries, and their sum) and economic cost (property damage, crop damage, and their sum) across event types [defined in National Weather Service Instruction 10-1605](https://www.ncdc.noaa.gov/stormevents/pd01016005curr.pdf).

Our analysis period covers 1993 to 2011. Additionally, we make a best faith effort to correct significant ambiguities and gaps between data and documentation, according to NWS guidelines.

Main results are presented via panel plots, and discussed and summarized. A full table of final calculations is provided in the appendices section. All code required to fully reproduce results from the given data is included, as well as a detailed account of the exploratory steps taken.

## Data Processing

Data analysis will be performed in **R**, making use of the following **R** packages:

```{r libraries, warning = FALSE, message = FALSE}
  library(data.table)
  library(xtable)
  library(reshape2)
  library(ggplot2)
```

Data is acquired in comma delimited format from a [mirrored bz2 archive](http://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2) containing NOAA Storm Database data from January 1950 to November 2011. If not already present in the working directory, it will be acquired from online. This process may be time- and memory-conusming.

We will extract only columns of interest for our analysis -- begin date, event type, and data columns related to fatalities, injuries, property damage, and crop damage.

```{r read, cache = TRUE}
  f <- "repdata-data-StormData.csv.bz2"
  if(!file.exists(f)) {
    # Download file if not present in working directory.
    f.url <- "http://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
    download.file(f.url, destfile = f, mode = "wb")
  }
  
  # Read file as data.table.
  dt <- as.data.table(read.csv(f,
  colClasses = c(
    "NULL",              
    "character",          # BGN_DATE
    rep("NULL", 5),   
    "factor",             # EVTYPE
    rep("NULL", 14),  
    "character",          # FATALITIES
    "numeric",            # INJURIES
    "numeric",            # PROPDMG
    "factor",             # PROPDMGEXP
    "numeric",            # CROPDMG
    "factor",             # CROPDMGEXP
    rep("NULL", 9) 
  )
))
```

## Exploratory Data Analysis

### Year selection (1993-2011)
The [NOAA Storm Events Database page](http://www.ncdc.noaa.gov/stormevents/details.jsp) documents that in earlier years, only data from a small handful of categories (Tornado, Thunderstorm Wind, and Hail) were gathered prior to 1996. To avoid skewed results, we will only consider data from years in which a wide range of event types were recorded.

To aid our exploratory analysis, we convert the beginning date `BGN_DATE` in the data to a numerical year value and investigate the number of unique event types (`EVTYPE`) in the data by year. In particular, we're looking for years in which more than three event types were recorded.

```{r explore_year, cache = TRUE}
  # Obtain year and store in new variable.
  dt$BGN_DATE <- gsub(" .+", "", dt$BGN_DATE) 
  dt$BGN_DATE <- as.Date(dt$BGN_DATE, "%m/%d/%Y")
  dt$year <- year(dt$BGN_DATE)
  
  # Explore unique EVTYPE by year.
  dt[, .(uniques = length(unique(EVTYPE))), by = year][uniques > 3]
```

There appears to be a discrepancy here. The NOAA page refers to a more recent version of the database, and it's possible that different decisions have been made as a result. Let us confirm both that only Tornado, Thunderstorm Wind, and Hail data are available before 1993, and also that a wide range of event types are available from 1993 onward.
   
```{r explore_1993}
  # Confirm pre-1993 EVTYPE variation.
  as.character(unique(dt[year < 1993]$EVTYPE))
  
  # Show EVTYPE variation from 1993 through 1995.
  dt.explore <- dt[year >= 1993 & year < 1996, .(records = nrow(.SD)), by = EVTYPE]
  dt.explore[order(-records)][1:10]
  
  # Compare to 1996 through 1998.
  dt.explore <- dt[year >= 1996 & year < 1999, .(records = nrow(.SD)), by = EVTYPE]
  dt.explore[order(-records)][1:10]
```  
A breadth of `EVTYPE` categories is present in both 1993-1995 and 1996-1998, with no strong evidence for excluding the former years. With that in mind, we will select **1993 to 2011** as the period for this analysis on the basis that the event types recorded in this period appear are wide-ranging. 

```{r process_year}
  # Process data to remove data prior to 1993.
  dt <- dt[year >= 1993]
```  

### Property and Crop Damage Exponents

To continue our exploratory analysis, we investigate the meaning of the `PROPDMGEXP` and `CROPDMGEXP` modifiers in the post-1993 data that remains. First, we look at all levels of these factors that appear in the data.

```{r explore_exp}
  levels(dt$PROPDMGEXP)
  levels(dt$CROPDMGEXP)
```  

For the numbers and letters, the variable names and NOAA instructions offer a useful guide. That is, numerics are exponents, and (for various capitalizations), **M** = millions, **B** = billions, **K** = thousands, and **H** = hundreds. The field is left blank where not applicable. 

We proceed to investigate records (if any) associated with the remaining ambiguous modifiers:

```{r explore_weird_exp}
  cols <- c("EVTYPE", "FATALITIES", "INJURIES", "PROPDMG", "PROPDMGEXP")
  dt[PROPDMGEXP %in% c("+", "?", "-") & PROPDMG > 0, cols, with = FALSE]
  cols <- c("EVTYPE", "FATALITIES", "INJURIES", "CROPDMG", "CROPDMGEXP")
  dt[CROPDMGEXP %in% c("?") & CROPDMG > 0, cols, with = FALSE]
```

We feel it a best guess that in such cases, no multipliers are to be applied; that **+**, **-**, and **?** indicate uncertainty about the damage provided without changes in order of magnitude. We must caution that possibly arbitrary amounts of error may be introduced by any assumption (or lack thereof) regarding unknown exponents. However, from our exploration of the data, we feel large-scale errors are unlikely to result from our interpretation.

With that caveat in mind, we may now calculate true property and crop damage values to aid in data summary.

```{r process_exp}
  # Work with copies of original variables.
  dt$propexp <- dt$PROPDMGEXP
  dt$cropexp <- dt$CROPDMGEXP
  
  # Modify factor levels to numeric exponent multipliers.
  levels(dt$propexp) <- c(
    "0", "0", "0", "0", 0:8, "9", "2", "2", "3", "6", "6"
  )
  levels(dt$cropexp) <- c(
    "0", "0", "0", "2", "9", "3", "3", "6", "6"
  )
  
  # Create true damage variables.
  dt$prop <- dt$PROPDMG * 10^(as.numeric(as.character(dt$propexp)))
  dt$crop <- dt$CROPDMG * 10^(as.numeric(as.character(dt$cropexp)))
```  
### Sum data by EVTYPE

We will now sum over all measures in the 1993-2011 data by provided event type. This paves the way for our exploratory analysis of `EVTYPE`.

```{r dt_new_format}
  dt.sum <- dt[,
    .(
      fatalities = sum(as.numeric(FATALITIES)),
      injuries = sum(INJURIES),
      totalPerson = sum(as.numeric(FATALITIES) + INJURIES),
      prop = sum(prop),
      crop = sum(crop),
      totalDamage = sum(prop + crop),
      numRecords = nrow(.SD)
    ),
    by = EVTYPE
  ]
```

### EVTYPE Coercion

The NOAA currently maintains a list of 48 distinct event types, but we find a much larger number of unique `EVTYPE` in the recorded data:

```{r explore_evtypes}
  # Total unique evtypes >= 1993.
  length(dt.sum$EVTYPE)
  # Total evtypes for events with nonzero impact >= 1993.
  length(dt.sum[totalPerson > 0 | totalDamage >0]$EVTYPE)
```  
As we saw earlier with our look at total unique `EVTYPE` by year, a number of the earlier years in the dataset are particularly responsible for this variation.

Fortunately, **Instruction 10-1605** offers considerable guidance in resolving the discrepancy. A large number of these `EVTYPE` are spelling variations or may be explicitly coerced to one of the 48 NWS event types. What remains are largely judgment calls between official categories. A few`EVTYPE` were deemed to have remained not coerceable and were categorized in "Other" categories.

We will focus only on coercing events with nonzero impact in this timeframe to the official NWS list. Full coercion code is extremely verbose and is removed from view here, but please note that it is reproduced in the **Appendix C** in the interests of full reproducibility and documentation. 

Our interpretations (decisions beyond clear spelling variations) and approach are described in the following sections.

#### A Low Preference for Winds

In `EVTYPE` where winds and another event (usually winter storms) were both named, a preference was given to the non-wind related event. The NWS guide recommends noting the wind presence manually:

> Some Winter Storm and Blizzard events may have had sustained or maximum wind gusts that met or exceeded High Wind criteria. Rather than document an additional High Wind event, the *Storm Data* preparer should just mention the time, location, and wind value in the Winter Storm or Blizzard event narrative. This is permissible even if only light snow and minor blowing snow...occurred with the high winds...(p. 91).

#### A Preference for Lower Degree Events

Where an `EVTYPE` doesn't clearly correspond to one of several official event types varying by degree, the lowest degree is preferred. 

Examples include (`Winter Weather` / `Heavy Snow` / `Winter Storm` / `Blizzard`), (`Strong Wind` / `High Winds`), (`Heat` / `Excessive Heat`), (`High Surf` / `Storm Surge`), and (`Cold` / `Extreme Cold`), and (`Flood` / `Flash Flood`).

The NWS instructions list specific thresholds or requirements. For example:

> ...if blizzard-like conditions occur for less than 3 hours, the event should be entered as a Winter Storm, Heavy Snow, or Winter Weather (p. 92).

Thus, blizzard events were reserved for those explicitly named as such.

Coastal storms and coastal erosion were regarded as `Storm Surge/Tide` events because they were not specifically attributed to tropical depressions, and from the NWS language, not merely events of high surf.

#### A Preference for Specific Events

In the case of `EVTYPE` naming two very distinct categories, the more specific occurrence is preferred. For example, floods, drought, avalanches, and surf are preferred if they are named along with other general events (such as "heat" or "rain"). 

When thunderstorm winds are mentioned alongside either lightning or hail, the latter is preferred as the more specific feature likely to be specified in the damage record.

#### Debris Flow 
The event formerly known as "landslide" was modified to fall under the `Debris Flow` category explicitly in instruction 10-1605. We have also taken "Mudslides" in this category.

#### Flooding
The `Flash Flood` event type is characterized by:

> ...rapid and extreme flow of high water into a normally dry area, or a rapid water level rise in a stream or creek  above a predetermined flood level, beginning within six hours of the causative event (e.g., intense rainfall, dam failure, ice jam-related) (p.32).

As a result, dam failure events and ice jam (except minor) were categorized as `Flash flood`, while most other non-coastal floods were catagorized as `Flood`. As is the case with other categories, the distinction between the two can be a judgment call even for the preparer entering the data.

Some `EVTYPE` coerced to flooding don't contain the word "flood" itself, but the term "Urban Flooding" is used exclusively in a flooding context, and as such "Urban" only events were also regarded as floods.

#### Thunderstorms

Downbursts, microbursts, and gustnadoes are explicitly defined to fall under the `Thunderstorm Wind` category (p. 70-71).

#### Gradient Wind

Gradient winds appear to be regarded in the NWS language as a feature of `Tropical Depressions`, and they are categorized this way. This is consistent with overall coercion methods; such coercions were in cases where more extreme events such as `Hurricane` and `Tropical Storm` were not specifically named, and the existence of a pressure gradient indicates greater specificity than other wind categories (`Strong Wind` and `High Winds`). Additionally, `EVTYPE` naming gradient wind were the only damage-causing entries for `Tropical Depression` to appear in the NWS instructions. 

#### Tornadoes and Waterspouts

In cases where these two categories both named in `EVTYPE`, we elected to categorize as a waterspout, on the grounds that the latter is more specific. Instructions specify that damage on land is to be classified `Tornado` while damage over water is to be specified `Waterspout`; our interpretation is that any "Waterspout" designation specifically indicates the waterspout portion of a tornado event.

Landspouts, on the other hand, are explicitly designated as Tornado events.

#### Winter Weather

`Winter Weather` was defined as encompassing "one or more winter precipitation types that...does not meet locally/regionally defined warning criteria" (p. 92). We prefer it to encompass most events that do not make a strong case for inclusion in another winter category. 

Single, multiple and "Mix" winter precipitation events (including snow squalls, "thundersnow", and "Heavy Mix") were categorized as `Winter Weather` unless two or more categories named are more extreme events that meet warning criteria. A set of "Heavy Snow Squall" `EVTYPE` were regarded as `Heavy Snow` instead by the specificity guideline.

Ice events that do not explicitly make clear that accumulation meets warning threshold were also categorized here.

#### Winter Storms

A `Winter Storm` is defined an event featuring "more than one significant hazard" (p. 91) and meets a warning criteria, but not rising to the level of a `Blizzard`.

Examples of this included "snow and ice", "snow and sleet", "sleet and ice", "heavy snow and blowing snow", and "snow, sleet, and ice". If it's not clear that a local warning criteria of some kind has been met (for example, by "High Winds", "Sleet", or "Heavy Snow"), then we default to the weaker classification of `Winter Weather` in keeping with a conservative communicated approach regarding `Winter Storm`:

Blizzards, as previously noted, were reserved for events specifically named as such.

#### "Other" Events.

There remained events that were not coerced to any of the existing 48 NWS categories. These were instead coerced to one of the following categories:

1. **X-OTHER**: For truly ambiguous `EVTYPE` not fitting into any other category.
1. **X-MARINE**: For marine-related `EVTYPE` not obviously fitting into the existing marine categories.
1. **X-ZERO**: For `EVTYPE` that didn't record damage of any kind in the 1993-2011 data.

```{r event_coercion_verbose, echo = FALSE}
  # Redefine levels for new "event" variable.
  event.coercion <- list(
    "X-ZERO" = as.character(
      dt.sum[totalPerson == 0 & totalDamage == 0]$EVTYPE
    ),
    "ASTRONOMICAL LOW TIDE" = "ASTRONOMICAL LOW TIDE",
    "AVALANCHE" = c(
      "AVALANCE",
      "HEAVY SNOW/BLIZZARD/AVALANCHE"
    ),
    "BLIZZARD" = c(
      "HEAVY SNOW/BLIZZARD",
      "BLIZZARD/WINTER STORM",
      "GROUND BLIZZARD",
      "HIGH WIND/BLIZZARD"
    ),
    "COASTAL FLOOD" = c(
      "Coastal Flood",
      "HEAVY SURF COASTAL FLOODING",
      "COASTAL FLOODING",
      "HIGH WINDS/COASTAL FLOOD",
      "Coastal Flooding",
      "Erosion/Cstl Flood",
      "COASTAL FLOODING/EROSION",
      "COASTAL  FLOODING/EROSION"
    ),
    "COLD/WIND CHILL" = c(
      "COOL AND WET",
      "COLD AND WET CONDITIONS",
      "RECORD COLD",
      "FOG AND COLD TEMPERATURES",
      "HYPOTHERMIA",
      "COLD/WINDS",
      "Hypothermia/Exposure",
      "UNSEASONABLY COLD",
      "COLD WAVE",
      "LOW TEMPERATURE",
      "COLD WEATHER",
      "Unseasonable Cold",
      "Extended Cold",
      "Cold",
      "Cold Temperature",
      "COLD"
    ),
    "DEBRIS FLOW" = c(
      "Landslump",
      "LANDSLIDES",
      "LANDSLIDE",
      "MUDSLIDES",
      "MUD SLIDE",
      "MUD SLIDES",
      "MUDSLIDE",
      "ROCK SLIDE",
      "Mudslides",
      "Mudslide"
    ),
    "DENSE FOG" = c(
      "FOG"
    ),
    "DENSE SMOKE" = "DENSE SMOKE",
    "DROUGHT" = c(
      "DROUGHT/EXCESSIVE HEAT",
      "HEAT WAVE DROUGHT"
    ),
    "DUST DEVIL" = c(
      "Dust Devil"
    ),
    "DUST STORM" = c(
      "BLOWING DUST",
      "DUST STORM/HIGH WINDS"
    ),
    "EXCESSIVE HEAT" = c(
      "EXTREME HEAT",
      "RECORD/EXCESSIVE HEAT"
    ),
    "EXTREME COLD/WIND CHILL" = c(
      "EXTREME COLD",
      "EXTREME WIND CHILL",
      "EXTREME WINDCHILL",
      "Extreme Cold",
      "HYPOTHERMIA/EXPOSURE",
      "HYPERTHERMIA/EXPOSURE"
    ),
    "FLASH FLOOD" = c(
      " FLASH FLOOD",
      "FLASH FLOOD",
      "RAPIDLY RISING WATER",
      "DAM BREAK",
      "ICE JAM",
      "ICE STORM/FLASH FLOOD",
      "FLASH FLOODING",
      "FLASH FLOODS",
      "FLASH FLOOD WINDS",
      "FLASH FLOOD/",
      "FLASH FLOOD - HEAVY RAIN",
      "FLASH FLOOD/ STREET",
      "FLOOD FLASH",
      "FLOOD/FLASH",
      "FLASH FLOODING/FLOOD",
      "FLASH FLOOD/LANDSLIDE",
      "FLASH FLOOD LANDSLIDES",
      "FLASH FLOOD",
      "FLASH FLOODING/THUNDERSTORM WI",
      "FLOOD/FLASH FLOOD",
      "FLASH FLOOD/FLOOD",
      "FLASH FLOOD FROM ICE JAMS",
      "FLOOD/FLASHFLOOD",
      "ICE JAM FLOODING",
      "FLOOD/FLASH/FLOOD"
    ),
    "FLOOD" = c(
      "HIGH WATER",
      "MUD SLIDES URBAN FLOODING",
      "FLOODING",
      "FLOODING/HEAVY RAIN",
      "FLOOD/RAIN/WINDS",
      "MINOR FLOODING",
      "FLOODS",
      "FLOOD/RIVER FLOOD",
      "Tidal Flooding",
      "River Flooding",
      "TIDAL FLOODING",
      "SNOWMELT FLOODING",
      "THUNDERSTORM WINDS/ FLOOD",
      "Ice jam flood (minor",
      "URBAN SMALL",
      "BREAKUP FLOODING",
      "RIVER FLOOD",
      "URBAN FLOODING",
      "URBAN FLOOD",
      "URBAN/SMALL STREAM FLOOD",
      "RURAL FLOOD",
      "MAJOR FLOOD",
      "SMALL STREAM FLOOD",
      "LAKE FLOOD",
      "URBAN AND SMALL STREAM FLOODIN",
      "RIVER AND STREAM FLOOD",
      "RIVER FLOODING",
      "URBAN/SMALL STREAM",
      "HEAVY RAIN AND FLOOD",
      "HEAVY RAINS/FLOODING",
      "THUNDERSTORM WINDS/FLOODING",
      "FLOOD & HEAVY RAIN",
      "URBAN FLOODS",
      "HEAVY RAIN/SMALL STREAM URBAN",
      "URBAN/SML STREAM FLD",
      "URBAN AND SMALL",
      "HEAVY SNOW/HIGH WINDS & FLOOD"
    ),
    "FREEZING FOG" = "FREEZING FOG",
    "FROST/FREEZE" = c(
      "Frost/Freeze",
      "FREEZE",
      "DAMAGING FREEZE",
      "FROST",
      "AGRICULTURAL FREEZE",
      "FROST\\FREEZE", 
      "HARD FREEZE",
      "Freeze",
      "Damaging Freeze",
      "Early Frost"
    ),
    "FUNNEL CLOUD" = c (
      "FUNNEL CLOUD",
      "FUNNEL",
      "THUNDERSTORM WINDS/FUNNEL CLOU"
    ),
    "HAIL" = c(
      "THUNDERSTORM HAIL",
      "THUNDERSTORM WINDSHAIL",
      "THUNDERSTORM WIND/HAIL",
      "THUNDERSTORM WINDS/HAIL",
      "THUNDERSTORM WINDS HAIL",
      "TSTM WIND/HAIL",
      "GUSTY WIND/HAIL",
      "HAIL 75",
      "SMALL HAIL",
      "HAIL 0.75",
      "HAIL/WINDS",
      "HAIL/WIND",
      "WIND/HAIL",
      "HAIL 175",
      "HAIL 100",
      "HAIL 150",
      "HAIL 075",
      "HAIL 125",
      "HAIL 200",
      "HAIL DAMAGE",
      "HAIL 275",
      "HAIL 450",
      "HAILSTORM"
    ),
    "HEAT" = c(
      "HEAT WAVE",
      "UNSEASONABLY WARM",
      "RECORD HEAT",
      "HEAT WAVES",
      "UNSEASONABLY WARM AND DRY",
      "Heat Wave",
      "WARM WEATHER"
    ),
    "HEAVY RAIN" = c(
      "RECORD RAINFALL",
      "HEAVY PRECIPITATION",
      "HEAVY RAINS",
      "RAINSTORM",
      "HEAVY RAIN/SEVERE WEATHER",
      "RAIN",
      "HVY RAIN",
      "RAIN/WIND",
      "EXCESSIVE RAINFALL",
      "Torrential Rainfall",
      "UNSEASONAL RAIN",
      "LIGHTNING AND HEAVY RAIN",
      "HEAVY RAIN/LIGHTNING",
      "LIGHTNING/HEAVY RAIN",
      "HIGH WINDS HEAVY RAINS",
      "HIGH WINDS/HEAVY RAIN",
      "HEAVY SHOWER"
    ),
    "HEAVY SNOW" = c(
      "SNOW AND HEAVY SNOW",
      "SNOW/HEAVY SNOW",
      "Heavy snow shower",
      "HEAVY SNOW SQUALLS",
      "HEAVY SNOW/SQUALLS",
      "HEAVY SNOW-SQUALLS",
      "HEAVY SNOWPACK",
      "HEAVY SNOW/WIND",
      "HEAVY SNOW/FREEZING RAIN",
      "HEAVY SNOW AND STRONG WINDS"
    ),
    "HIGH SURF" = c(
      "High Surf",
      "HIGH SURF ADVISORY",
      "   HIGH SURF ADVISORY",
      "Beach Erosion",
      "HIGH TIDES",
      "HEAVY SURF",
      "Heavy Rain/High Surf",
      "Heavy surf and wind",
      "HIGH WAVES",
      "ROUGH SURF",
      "Heavy Surf",
      "HIGH SWELLS",
      "HIGH SURF ADVISORY",
      "HAZARDOUS SURF",
      "ASTRONOMICAL HIGH TIDE",
      "HEAVY SURF/HIGH SURF"
    ),
    "HIGH WIND" = c(
      "WIND STORM",
      "STORM FORCE WINDS",
      "HIGH WINDS/COLD",
      "HIGH WINDS",
      "HIGH WIND DAMAGE",
      "HIGH WINDS/",
      "HIGH  WINDS",
      "HIGH WIND 48",
      "HIGH WIND (G40)"
    ),
    "HURRICANE/TYPHOON" = c(
      "HURRICANE OPAL/HIGH WINDS",
      "HURRICANE ERIN",
      "HURRICANE OPAL",
      "HURRICANE",
      "HURRICANE-GENERATED SWELLS",
      "HURRICANE EMILY",
      "HURRICANE GORDON",
      "HURRICANE FELIX",
      "Hurricane Edouard",
      "TYPHOON"
    ),
    "ICE STORM" = c(
      "ICE STORM",
      "GLAZE/ICE STORM"
    ),
    "LAKE-EFFECT SNOW" = c(
      "HEAVY LAKE SNOW",
      "LAKE EFFECT SNOW",
      "Lake Effect Snow"
    ),
    "LAKESHORE FLOOD" = "LAKESHORE FLOOD",
    "LIGHTNING" = c(
      "LIGHTING",
      "LIGHTNING INJURY",
      "LIGNTNING",
      "LIGHTNING.",
      "LIGHTNING FIRE",
      "LIGHTNING  WAUSEON",
      "THUNDERSTORM WIND/LIGHTNING",
      "TSTM WIND AND LIGHTNING",
      "THUNDERSTORM WINDS LIGHTNING"
    ),
    "MARINE HAIL" = "MARINE HAIL",
    "MARINE HIGH WIND" = c(
      "HIGH WIND/SEAS",
      "HIGH WIND AND SEAS"
    ),
    "MARINE STRONG WIND" = "MARINE STRONG WIND",
    "MARINE THUNDERSTORM" = c(
      "MARINE TSTM WIND",
      "MARINE THUNDERSTORM WIND"
    ),
    "RIP CURRENT" = c(
      "RIP CURRENTS/HEAVY SURF",
      "RIP CURRENTS"
    ),
    "SEICHE" = "SEICHE",
    "SLEET" = c(
      "FREEZING RAIN/SLEET"
    ),
    "STORM SURGE/TIDE" = c(
      "STORM SURGE",
      "COASTAL STORM",
      "COASTAL SURGE",
      "COASTAL EROSION",
      "Coastal Storm",
      "COASTALSTORM"
    ),
    "STRONG WIND" = c(
      "Strong Wind",
      "GUSTY WIND/HVY RAIN",
      "WIND",
      "WIND DAMAGE",
      "GUSTY WINDS",
      "WINDS",
      "Gusty wind/rain",
      "Gusty Winds",
      "GUSTY WIND",
      "Gusty winds",
      "NON-TSTM WIND",
      "NON TSTM WIND",
      "STRONG WINDS",
      "Wind",
      "Wind Damage",
      "Strong Winds",
      "NON-SEVERE WIND DAMAGE"
    ),
    "THUNDERSTORM WIND" = c(
      "GUSTNADO",
      " TSTM WIND (G45)",
      " TSTM WIND",
      "THUNDERSTORM WINDS",
      "THUNDERSTORM WINS",
      "THUNDERSTORM",
      "SEVERE THUNDERSTORM",
      "SEVERE THUNDERSTORMS",
      "SEVERE THUNDERSTORM WINDS",
      "THUNDERSTORMS WINDS",
      "THUNDERSTORMS",
      "THUNDERSTORM WINDSS",
      "LIGHTNING THUNDERSTORM WINDS",
      "LIGHTNING AND THUNDERSTORM WIN",
      "THUNDERSTORM WINDS53",
      "THUNDERSTORM WINDS 13",
      "TSTM WIND 55",
      "THUNDERTORM WINDS",
      "THUNDERSTORMS WIND",
      "THUNDERSTORM  WINDS",
      "TUNDERSTORM WIND",
      "THUNDERSTORM WIND G50",
      "THUNDERSTORM WIND G60",
      "THUNDERSTORM WINDS.",
      "THUNDERSTORM WIND G55",
      "THUNDERSTORM WINDS G60",
      "TSTM WIND G58",
      "THUNDERSTORM WIND 60 MPH",
      "THUNDERSTORM WIND 65MPH",
      "THUNDERSTORM WIND/ TREES",
      "THUNDERSTORM WIND/AWNING",
      "THUNDERSTORM WIND 98 MPH",
      "THUNDERSTORM WIND TREES",
      "THUNDERSTORM WINDS 63 MPH",
      "THUNDERSTORM WIND/ TREE",
      "THUNDERSTORM DAMAGE TO",
      "THUNDERSTORM WIND 65 MPH",
      "THUNDERSTORM WIND.",
      "THUDERSTORM WINDS",
      "THUNDERSTORM WINDS AND",
      "TSTM WIND DAMAGE",
      "THUNDERSTORM WIND G52",
      "THUNDERESTORM WINDS",
      "THUNDEERSTORM WINDS",
      "THUNERSTORM WINDS",
      "THUNDERSTORMW",
      "TSTM WINDS",
      "TSTMW",
      "TSTM WIND 65)",
      "THUNDERSTORMWINDS",
      "THUNDERSTROM WIND",
      "Tstm Wind",
      "TSTM WIND (G45)",
      "TSTM WIND 40",
      "TSTM WIND 45",
      "TSTM WIND (41)",
      "TSTM WIND (G40)",
      "TSTM WIND",
      "TSTM WIND (G45)",
      "TSTM WIND  (G45)",
      "TSTM WIND (G35)",
      "TSTM WIND G45",
      "THUNDERSTORM WIND (G40)",
      "DRY MICROBURST",
      "MICROBURST",
      "DOWNBURST",
      "WET MICROBURST",
      "DRY MIRCOBURST WINDS",
      "MICROBURST WINDS",
      "Microburst",
      "Gustnado"
    ),
    "TORNADO" = c(
      "TORNADO F3",
      "TORNADO F0",
      "TORNADOES, TSTM WIND, HAIL",
      "COLD AIR TORNADO",
      "TORNADO",
      "TORNDAO",
      "TORNADO F1",
      "TORNADO F2",
      "TORNADOES",
      "Whirlwind",
      "LANDSPOUT",
      "WHIRLWIND"
    ),
    "TROPICAL DEPRESSION" = c(
      "Gradient wind",
      "GRADIENT WIND",
      "gradient wind"
    ),
    "TROPICAL STORM" = c(
      "TROPICAL STORM ALBERTO",
      "TROPICAL STORM GORDON",
      "TROPICAL STORM JERRY",
      "TROPICAL STORM DEAN"
    ),
    "TSUNAMI" = "TSUNAMI",
    "VOLCANIC ASH" = "Volcanic Ash",
    "WILDFIRE" = c(
      "WILD FIRES",
      "WILD/FOREST FIRE",
      "GRASS FIRES",
      "FOREST FIRES",
      "WILDFIRES",
      "WILD/FOREST FIRES",
      "BRUSH FIRE"
    ),
    "WATERSPOUT" = c(
      "WATERSPOUT",
      "DUST DEVIL WATERSPOUT",
      "WATERSPOUT/TORNADO",
      "WATERSPOUT TORNADO",
      "WATERSPOUT-TORNADO",
      "WATERSPOUT/ TORNADO",
      "WATERSPOUT-"
    ),
    "WINTER WEATHER" = c(
      "MIXED PRECIP",
      "Mixed Precipitation",
      "MIXED PRECIPITATION",
      "ICE",
      "SNOW",
      "BLOWING SNOW",
      "GLAZE",
      "RAIN/SNOW",
      "GLAZE ICE",
      "SNOW/ ICE",
      "SNOW/ICE",
      "ICE AND SNOW",
      "SNOW AND ICE",
      "SNOW/COLD",
      "ICY ROADS",
      "SNOW/ BITTER COLD",
      "SNOW ACCUMULATION",
      "Snow",
      "blowing snow",
      "Glaze",
      "COLD AND SNOW",
      "BLACK ICE",
      "ICE ROADS",
      "LATE SEASON SNOW",
      "FALLING SNOW/ICE",
      "ICE ON ROAD",
      "WINTRY MIX",
      "LIGHT SNOW",
      "Wintry Mix",
      "Light snow",
      "Light Snow",
      "Light Snowfall",
      "WINTER WEATHER MIX",
      "WINTER WEATHER/MIX",
      "FREEZING DRIZZLE",
      "Freezing Rain",
      "Freezing Drizzle",
      "Freezing drizzle",
      "LIGHT FREEZING RAIN",
      "FREEZING RAIN",
      "HEAVY MIX",
      "FREEZING RAIN/SNOW",
      "SNOW/BLOWING SNOW",
      "SNOW FREEZING RAIN",
      "SNOW/FREEZING RAIN",
      "SNOW SQUALLS",
      "SNOW SQUALL",
      "RECORD SNOW",
      "Snow Squalls",
      "EXCESSIVE SNOW",
      "ICE/STRONG WINDS",
      "HIGH WINDS/SNOW",
      "SNOW/HIGH WINDS",
      "THUNDERSNOW"
    ),
    "WINTER STORM" = c(
      "SLEET/ICE STORM",
      "HEAVY SNOW/WINTER STORM",
      "WINTER STORM HIGH WINDS",
      "WINTER STORMS",
      "HEAVY SNOW AND HIGH WINDS",
      "HIGH WIND/HEAVY SNOW",
      "SNOW/SLEET",
      "HEAVY SNOW/ICE",
      "SNOW AND ICE STORM",
      "SNOW/ICE STORM",
      "SNOW/SLEET/FREEZING RAIN",
      "HEAVY RAIN/SNOW"
    ),
    "X-MARINE" = c(
      "MARINE MISHAP",
      "HIGH SEAS",
      "HEAVY SEAS",
      "HEAVY SWELLS",
      "Marine Accident",
      "Freezing Spray",
      "WIND AND WAVE",
      "ROUGH SEAS",
      "ROGUE WAVE"
    ),
    "X-OTHER" = c(
      "SEVERE TURBULENCE",
      "APACHE COUNTY",
      "HIGH",
      "EXCESSIVE WETNESS",
      "OTHER",
      "?",
      "Other",
      "ICE FLOES",
      "DROWNING"
    )
  )
```  
Under the guidelines documented above, we construct a manual mapping list named `event.coercion` (see **Appendix C** for the construction code) to re-level the existing `EVTYPE` factor to our set of coerced choices. We chose a manual mapping over pattern matching for reproducibility, so it is clear exactly where `EVTYPE` in the data is mapped.

```{r process_data_final}
  
   # Coerce EVTYPE to new `event` variable using mappling list.
  dt.sum$event <- dt.sum$EVTYPE
  levels(dt.sum$event) <- event.coercion

  # Resum dataset observations by coerced `event` variable.
  dt.results <- dt.sum[, 
    .(
      fatalities = sum(fatalities),
      injuries = sum(injuries),
      totalPerson = sum(totalPerson),
      prop = sum(prop),
      crop = sum(crop),
      totalDamage = sum(prop + crop)
    ),
    by = event
  ]
  
  # Check unique events in resulting data.
  length(dt.results$event)
  # Ensure no NAs have resulted from EVTYPE coercion.
  complete.cases(unique(dt.sum$event))
```  
Note that there are three "Other" event types included in `dt.results`.

With the `EVTYPE` so coerced in the new `event` variable, we are now ready to present results.

## Results

We represent our results in two single panel plots, one for personal health impact and one for economic impact. 

Despite the wide spread of the data, we chose not to use a log scale in order to more clearly illustrate the gulf of the discrepancy between top events and lower events.

Another aim of the panel plot is to illustrate relative percentages of total personal or economic impact from each of the constituent categories. For example, if injuries outnumber fatalities significantly, we want this to be visually apparent.

### Person Impact

```{r results_plot_person, fig.width = 10, fig.height = 10, fig.cap = "Figure 1: Results (Person)", results = "asis"}
  # Melt data to narrow form for plotting.
  dt.person <- dt.results[
    order(-totalPerson, -fatalities, -injuries),
    .(
      "Fatalities" = fatalities,
      "Injuries" = injuries,
      "Total" = totalPerson,
      event = event
    )
  ]
  
  melt.person <- melt(dt.person, id.vars = "event")

  # Order bars by total person count.
  melt.person$eventOrder <- factor(
    melt.person$event, 
    levels = dt.person[order(-Total)]$event
  )
  
  # Bar plot.
  ggplot(melt.person, aes(x = eventOrder, y = value, fill = eventOrder)) +
    geom_bar(stat = "identity") + coord_flip() +
    facet_grid(.~ variable) +
    theme(legend.position="none") +
    theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) +
    labs(x = "Event Type\n", y = "\nPerson Count") +
    labs(title = "Personal Harm from Severe Weather Events in the U.S. 1993-2011\n")
```  
In terms of total person count impact, we observe the following Top 5:

```{r results_person_top_5}
  dt.person[1:5]
```  

**Tornadoes** are overwhelmingly top offenders, with a significant share of their personal health impact coming from injuries rather than fatalities. In fatalities alone, **heat** related events figure most prominently.

In bears noting that many of the top events in this order are also closely related. We continue our analysis by grouping contributors into related categories.

#### Percentages By Tier
```{r results_person_percentage, warning = FALSE, message = FALSE}
  # Organize contributing events by tiers.
  tiers.person <- list(
    tornado = "TORNADO",
    heat = c("EXCESSIVE HEAT", "HEAT"),
    flood = c("FLOOD", "FLASH FLOOD"),
    thunderstorm = c("THUNDERSTORM WIND", "LIGHTNING"),
    winter = c(
      "ICE STORM", "WINTER STORM", "WINTER WEATHER",
      "HEAVY SNOW", "BLIZZARD", "SLEET",
      "EXTREME COLD/WIND CHILL", "COLD/WIND CHILL"
    ),
    misc = c(
      "HURRICANE/TYPHOON", "TROPICAL STORM",
      "HEAVY RAIN", "STRONG WIND", "HIGH WIND",
      "HIGH SURF", "RIP CURRENT",
      "HAIL", "DENSE FOG", "DUST STORM",
      "AVALANCHE", "WILDFIRE"
    )
  )
  
  # Report percentage of total impact from each tier.
  report.people <- as.data.table(lapply(tiers.person, 
    function(e) {
      100 * sum(dt.person[event %in% e]$Total) /
    sum(dt.person$Total)
    }
  ))
  
  # Add sum percentage of all tiers.
  melt(report.people[, "Total %" := sum(report.people[1])])[order(-value)]
```

### Economic Impact

```{r results_plot_economic, fig.width = 10, fig.height = 10, fig.cap = "Figure 2: Results (Economic)", results = "asis"}
   # Melt data to narrow form for plotting.
  dt.econ <- dt.results[
    order(-totalDamage, -prop, -crop),
    .("Property" = prop,
      "Crop" = crop,
      "Total" = totalDamage,
      event = event
    )
  ]
  
  melt.econ <- melt(dt.econ, id.vars = "event")

  # Order bars by total person count.
  melt.econ$eventOrder <- factor(
    melt.econ$event, 
    levels = dt.econ[order(-Total)]$event
  )
  
  # Bar plot.
  ggplot(melt.econ, aes(x = eventOrder, y = value + 1, fill = eventOrder)) +
    geom_bar(stat = "identity") + coord_flip() +
    facet_grid(.~ variable) +
    theme(legend.position = "none") +
    theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) +
    labs(x = "Event Type\n", y = "\n(Unadjusted) USD") +
    labs(title = "Economic Damage (USD) from Severe Weather Events in the U.S. 1993-2011\n")
```  

In terms of total economic impact, we observe the following top 5 (in billions of USD):

```{r results_economic_top_5}
  options(scipen = 999)
  dt.econ[1:5,
    .(
      "Property" = Property / 10^9,
      "Crop" = Crop / 10^9,
      "Total" = Total / 10^9,  
      "event" = event
    )
  ]
```  

**Floods** are by an overwhelming margin the most costly sources of damage, with **hurricanes** and **storm surges** following, and we quickly approach order of magnitude differences to later events in the list.

**Droughts** bear special mention as the leading cause of crop damage. However, property damages comprise the bulk of economic costs of severe weather events in the U.S.

#### Percentages By Tier
```{r results_econ_percentage, warning = FALSE, message = FALSE}
  # Organize contributing events by tiers.
  tiers.econ <- list(
    Flood = c("FLOOD", "FLASH FLOOD"),
    Hurricane = c("HURRICANE/TYPHOON", "TROPICAL STORM"),
    "Storm Surge" = c("STORM SURGE/TIDE", "COASTAL FLOOD"),
    Tornado = "TORNADO",
    Winter = c("ICE STORM", "WINTER STORM", "FROST/FREEZE", 
      "EXTREME COLD/WIND CHILL", "HEAVY SNOW", "BLIZZARD"),
    Storms = c("THUNDERSTORM WIND", "HIGH WIND", "HEAVY RAIN"),
    Hail = "HAIL",
    Drought = "DROUGHT",
    Wildfire = "WILDFIRE"
  )
  
  # Report percentage of total impact from each tier.
  report.econ <- as.data.table(lapply(tiers.econ, 
    function(e) {
      100 * sum(dt.econ[event %in% e]$Total) /
    sum(dt.econ$Total)
    }
  ))
  
  # Add sum percentage of all tiers.
  melt(report.econ[, "Total %":= sum(report.econ[1])])[order(-value)]
```

## Summary

A lightly overlapping set of events (tornadoes, storms, winter events) are contributors in different degrees to both categories. Broadly speaking, the event profiles are quite different.

#### Top personal health impact events

Tornados are primarily response for record personal health damage in the United States. 

A quartet of related categories (listed here) each contribute sizably to the person count, and a numer of miscellaneous categories fill in the remainder. Overall, the causes of personal health damage in the U.S. are quite diverse.

1. Tornado  
1. Thunderstorms, Heat-related events, Flooding, and Winter-related events
1. Miscellaneous low-order impact event types

#### Top economic impact events

Over 70% of total economic consequences are concentrated in the top three event types.

Beyond that, a small collection of events contribute on the order of low single digit percentage points each. 

1. Flooding  
1. Hurricanes/Typhoons, and Tropical Storms 
1. Storm Surges
1. Tornadoes, Storms (winds and rains), Winter events, Jail, Drought, and Wildfire (all on a much smaller scale)

#### Caveats

The results of this study bear a number of caveats and context notes.

1. Source data was messy and required significant cleaning, which is documented but not certified by the NWS or NOAA.
1. Only cumulative impact was considered, rather than impact *incidence* or *average* impact. The focus was on a "sum total" picture of recorded data in the United States.
1. Variations in event incidence across regions was not considered. This report has a nationwide focus; those applying it towards local considerations are advised to bear local weather behavior and trends in mind.

## Appendices

### Appendix A: The 48 NWS event types

These are defined and explained in NWS Instruction 10-1605. In our data, to avoid confusion, we have capitalized every letter in `event` names.

1. Astronomical Low Tide  
1. Avalanche  
1. Blizzard  
1. Coastal Flood  
1. Cold/Wind Chill  
1. Debris Flow  
1. Dense Fog  
1. Dense Smoke  
1. Drought  
1. Dust Devil  
1. Dust Storm  
1. Excessive Heat  
1. Extreme Cold/Wind Chill  
1. Flash Flood  
1. Flood  
1. Freezing Fog  
1. Frost/Freeze  
1. Funnel Cloud  
1. Hail  
1. Heat  
1. Heavy Rain  
1. Heavy Snow  
1. High Surf  
1. High Wind  
1. Hurricane/Typhoon  
1. Ice Storm  
1. Lakeshore Flood  
1. Lake-Effect Snow  
1. Lightning  
1. Marine Hail  
1. Marine High Wind  
1. Marine Strong Wind  
1. Marine Thunderstorm  
1. Rip Current  
1. Seiche  
1. Sleet  
1. Storm Surge/Tide  
1. Strong Wind  
1. Thunderstorm Wind  
1. Tornado  
1. Tropical Depression  
1. Tropical Storm  
1. Tsunami  
1. Volcanic Ash  
1. Waterspout  
1. Wildfire  
1. Winter Storm  
1. Winter Weather  

### Appendix B: Full list of damage-causing EVTYPEs
The following is a a full list of unique `EVTYPE` (excluding ones which never have recorded damages of any kind). All of these are explicitly mapped to either an official NWS event type designation or an "Other" category by the coercion mapping printed in the following section.

```{r appendix_unique_nonzero_evtype}
  sort(as.character(dt.sum[totalPerson > 0 | totalDamage > 0]$EVTYPE))
```  

### Appendix C: Full coercion mapping code
The construction of our coercion mapping list, in a variable named `event.coercion`, was hidden from view above to the length of the code chunk. It is reproduced by reference here in order to fully document all code used to prepare this report.

```{r duplicate_event_coercion, ref.label = "event_coercion_verbose"}
```

### Appendix D: Full Results
Our results were represented visually in the report. The full data is printed here as a detailed reference. The `xtable` package is used to present the `data.table` output in more readable format. This table is ordered by total economic impact (descending).

```{r appendix_full_data, results = "asis"}
  # Add "Totals" row to results summary.
  dt.results.summary <- rbind(
    list(
      Event = "Totals",
      Fatalities = sum(dt.results$fatalities),
      Injuries = sum(dt.results$injuries),
      Total = sum(dt.results$totalPerson),
      "Property Damage" = sum(dt.results$prop),
      "Crop Damage" = sum(dt.results$crop),
      "Total Damage" = sum(dt.results$totalDamage)
    ),
    dt.results[order(-totalDamage),
      .(
        Event = event,
        Fatalities = fatalities,
        Injuries = injuries,
        Total = totalPerson,
        "Property Damage" = prop,
        "Crop Damage" = crop,
        "Total Damage" = totalDamage
      )
    ]
  )
  # Use xtable to print in nice format.
  print(
    xtable(
      dt.results.summary,
      caption = "Table 1: Personal health and economic damage (USD) from NOAA Storm Events Database, 1993-2011",
      digits = c(0, 0, 0, 0, 0, -3, -3, -3)
    ), 
    type = "html",
    caption.placement = "top"
  )
```
## Final Remarks
Thank you for taking the time to review this report! Your comments and feedback are appreciated!

<div class="footer_spacer">&nbsp;</div>
